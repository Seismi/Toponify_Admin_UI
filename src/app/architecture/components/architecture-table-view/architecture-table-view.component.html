<div class="search-container">
  <input data-qa="topology-table-quick-search" #searchInput (keyup)="onSearch($event.target.value)" placeholder="Search" />
</div>
<table mat-table [dataSource]="dataSource" [style.width.%]="100">
  <!-- Category Column -->
  <ng-container matColumnDef="category">
    <th mat-header-cell *matHeaderCellDef>Category</th>
    <td mat-cell *matCellDef="let element" [ngSwitch]="element.category">
      <mat-icon *ngSwitchCase="'data structure'" svgIcon="data-data-structure"></mat-icon>
      <mat-icon *ngIf="element.isShared && element.category === 'data set'" svgIcon="data-data-set-shared"></mat-icon>
      <mat-icon *ngIf="!element.isShared && element.category === 'data set'" svgIcon="data-data-set-master"></mat-icon>
      <mat-icon *ngIf="element.isShared && element.category === 'master data set'"
        svgIcon="data-master-data-set-shared"></mat-icon>
      <mat-icon *ngIf="!element.isShared && element.category === 'master data set'"
        svgIcon="data-master-data-set-master"></mat-icon>
      <mat-icon *ngSwitchCase="'dimension'" svgIcon="dim"></mat-icon>
      <mat-icon *ngSwitchCase="'key'" svgIcon="rc-keyrc"></mat-icon>
      <mat-icon *ngSwitchCase="'list'" svgIcon="rc-list"></mat-icon>
      <mat-icon *ngSwitchCase="'structure'" svgIcon="rc-structure"></mat-icon>
      <mat-icon *ngSwitchCase="'analytical'" svgIcon="sys-analytical"></mat-icon>
      <mat-icon *ngSwitchCase="'master data'" svgIcon="sys-master-data"></mat-icon>
      <mat-icon *ngSwitchCase="'file'" svgIcon="sys-files"></mat-icon>
      <mat-icon *ngSwitchCase="'reporting'" svgIcon="sys-reporting"></mat-icon>
      <mat-icon *ngSwitchCase="'transactional'" svgIcon="sys-transactional"></mat-icon>
      <mat-icon *ngSwitchCase="'data'" svgIcon="data-interface"></mat-icon>
      <mat-icon *ngSwitchCase="'transformation'" svgIcon="transformation"></mat-icon>
      <mat-icon *ngSwitchCase="'manual processing'" svgIcon="sys-manual-processing"></mat-icon>
      <mat-icon *ngSwitchCase="'desktop application'" svgIcon="sys-desktop-application"></mat-icon>
      <mat-icon svgIcon="group" *ngIf="element.members?.length"></mat-icon>
    </td>
  </ng-container>

  <!-- Reference Column -->
  <ng-container matColumnDef="reference">
    <th mat-header-cell *matHeaderCellDef>Ref.</th>
    <td mat-cell *matCellDef="let element">{{ element.reference }}</td>
  </ng-container>

  <!-- Name Column -->
  <ng-container matColumnDef="name">
    <th mat-header-cell *matHeaderCellDef>Name</th>
    <td mat-cell *matCellDef="let element">{{ element.name }}</td>
  </ng-container>

  <!-- Description Column -->
  <ng-container matColumnDef="description">
    <th mat-header-cell *matHeaderCellDef>Description</th>
    <td mat-cell *matCellDef="let element">{{ element.description }}</td>
  </ng-container>

  <!-- Tags Column -->
  <ng-container matColumnDef="tags">
    <th mat-header-cell *matHeaderCellDef>Tags</th>
    <td mat-cell *matCellDef="let element">
      <mat-chip-list>
        <div *ngFor="let tag of element.tags">

          <smi-tag [removable]="false" [tag]="tag"></smi-tag>
        </div>
      </mat-chip-list>
    </td>
  </ng-container>

  <!-- RADIO Column -->
  <ng-container matColumnDef="radio">
    <th mat-header-cell *matHeaderCellDef>
      <mat-icon>track_changes</mat-icon>
    </th>
    <td mat-cell *matCellDef="let element">
      <ng-container *ngIf="element && element.relatedRadioCounts">
        <span matTooltip="risks" [ngStyle]="{ 'background-color': 'orange' }" class="badge badge-pill"
          *ngIf="element.relatedRadioCounts.risks > 0">
          {{ element.relatedRadioCounts.risks }}
        </span>
        <span matTooltip="assumptions" [ngStyle]="{ 'background-color': 'yellow' }" class="badge badge-pill"
          *ngIf="element.relatedRadioCounts.assumptions > 0">
          {{ element.relatedRadioCounts.assumptions }}
        </span>
        <span matTooltip="dependencies" [ngStyle]="{ 'background-color': 'blue' }" class="badge badge-pill"
          *ngIf="element.relatedRadioCounts.dependencies > 0">
          {{ element.relatedRadioCounts.dependencies }}
        </span>
        <span matTooltip="issues" [ngStyle]="{ 'background-color': 'red' }" class="badge badge-pill"
          *ngIf="element.relatedRadioCounts.issues > 0">
          {{ element.relatedRadioCounts.issues }}
        </span>
        <span matTooltip="opportunities" [ngStyle]="{ 'background-color': 'green' }" class="badge badge-pill"
          *ngIf="element.relatedRadioCounts.opportunities > 0">
          {{ element.relatedRadioCounts.opportunities }}
        </span>
      </ng-container>
    </td>
  </ng-container>

  <!-- Owner Column -->
  <ng-container matColumnDef="owner">
    <th mat-header-cell *matHeaderCellDef>Owner</th>
    <td mat-cell *matCellDef="let element">{{ element.owner }}</td>
  </ng-container>

  <!-- Source Column -->
  <ng-container matColumnDef="source">
    <th mat-header-cell *matHeaderCellDef>Source</th>
    <td mat-cell *matCellDef="let element">{{ element.sourceName }}</td>
  </ng-container>

  <!-- Target Column -->
  <ng-container matColumnDef="target">
    <th mat-header-cell *matHeaderCellDef>Target</th>
    <td mat-cell *matCellDef="let element">{{ element.targetName }}</td>
  </ng-container>

  <!-- Impacted By Column -->
  <ng-container matColumnDef="impactedBy">
    <th mat-header-cell *matHeaderCellDef>Impacted By</th>
    <td mat-cell *matCellDef="let element">
      <button 
        mat-icon-button
        *ngFor="let wp of element.impactedByWorkPackages"
        matTooltip="{{ wp.name }}"
        [ngStyle]="{ 'background-color': wp.displayColour }"
      >
      <mat-icon>business_center</mat-icon>
    </button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns" [ngClass]="{ highlight: selectedItem?.id == row.id }"
    (dblclick)="dblClick(row)" (click)="onSelect(row)"></tr>
</table>

<div *ngIf="!dataSource.filteredData.length" class="no-data-found">No data found</div>

<div class="table-footer">
  <div style="flex-grow: 1">
    <button data-qa="topology-table-create-new" mat-raised-button color="primary" class="add-btn"
      [disabled]="disableCreateNewButton()" (click)="onAdd()">
      <mat-icon>add</mat-icon>Create New
    </button>
  </div>
  <button data-qa="topology-table-download-csv" mat-icon-button (click)="downloadCSV()">
    <mat-icon title="Export as CSV">save_alt</mat-icon>
  </button>
  <mat-paginator [pageSizeOptions]="[10, 25, 50]"></mat-paginator>
</div>