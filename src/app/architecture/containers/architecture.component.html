<app-base-header>
  <smi-node-name *ngIf="parentName" [parentName]="parentName"></smi-node-name>
  <app-toolbar-column [fillFreeSpace]="true"> </app-toolbar-column>
  <smi-workpackage-name
    [selectedWorkPackageEntities]="selectedWorkPackageEntities"
    [workPackageIsEditable]="workPackageIsEditable"
    [workPackageName]="workPackageName"
    (exitWorkPackageEditMode)="onSelectEditWorkpackage($event)">
  </smi-workpackage-name>
  <app-search></app-search>
  <app-toolbar-column>
    <app-zoom-actions (zoomIn)="onZoomIn()" (zoomOut)="onZoomOut()"></app-zoom-actions>
    <app-layout-actions
      *ngIf="!attributesView"
      (showGrid)="onShowGrid()"
      [showOrHideGrid]="showOrHideGrid"
      (zoomMap)="onZoomMap()"
    ></app-layout-actions>
  </app-toolbar-column>
  <app-toolbar-column>
    <smi-quicklinks-actions
      [gojsView]="true"
      [scopes]="scopes$ | async"
      [selectedScope]="selectedScope$ | async"
      [layouts]="scopeDetails$ | async"
      (selectScope)="onSelectScope($event)"
      (selectLayout)="onSelectLayout($event)"
      [selectedLayout]="selectedLayout$ | async"
      (addLayout)="onAddLayout()"
    >
    </smi-quicklinks-actions>
  </app-toolbar-column>
</app-base-header>
<app-model-container [topPadding]="64">
  <smi-left-sidebar
    *ngIf="!showOrHideLeftPane"
    (leftTab)="openLeftTab($event)"
    [workPackageIsEditable]="workPackageIsEditable"
  >
  </smi-left-sidebar>
  <p class="leftPane" *ngIf="showOrHideLeftPane">
    <smi-left-panel
      [tabIndex]="editTabIndex"
      (tabClick)="onTabClick($event)"
      [viewLevel]="viewLevel$ | async"
      [workpackages]="workpackage$ | async"
      [workPackageIsEditable]="workPackageIsEditable"
      (displayOptionsChangedEvent)="displayOptionsChanged($event)"
      (selectWorkPackage)="onSelectWorkPackage($event)"
      (selectColour)="selectColourForWorkPackage($event)"
      (setWorkpackageEditMode)="onSelectEditWorkpackage($event)"
      [selectedLeftTab]="selectedLeftTab"
      [checked]="radioAlertChecked"
      [canSelectWorkpackages]="canSelectWorkpackages"
      (hideLeftPane)="onHideLeftPane()"
      [layoutSettingsTab]="layoutSettingsTab"
      (addLayout)="onAddLayout()"
      [group]="layoutSettingsForm"
      [layout]="layout"
      (filterRadioSeverity)="onFilterRadioSeverity()"
      (collapseAllNodes)="onCollapseAllNodes()"
      (summariseAllNodes)="onSummariseAllNodes()"
      [allowEditLayouts]="allowEditLayouts"
      (editLayout)="allowEditLayout()"
      (expandAll)="onExpandAll()"
      (downloadImage)="onDownloadImage()"
    >
    </smi-left-panel>
  </p>
  <app-model-content>
    <smi-switch-view-tabs
      (viewChange)="onViewChange($event)"
      [selectedView]="selectedView"
      [viewLevel]="viewLevel$ | async"
    ></smi-switch-view-tabs>
    <smi-search-table-view *ngIf="selectedView !== ArchitectureView.Diagram" (search)="onSearchTableView($event)">
    </smi-search-table-view>
    <div style="padding: 5px" [hidden]="selectedView !== ArchitectureView.Diagram">
      <app-architecture-diagram
        [mapView]="mapView"
        [showGrid]="showGrid"
        [allowMove]="allowMove"
        [workPackageIsEditable]="workPackageIsEditable"
        *ngIf="!showTable"
        [nodes]="nodes | layer: { byId: true, descendantIds$: parentDescendantIds } | async"
        [links]="links | layer: { byId: false } | async"
        [workpackageDetail]="workpackageDetail"
        [selectedId]="selectedId"
        [selectedWorkPackages]="selectedWorkPackages$ | async"
        [workpackages]="workpackage$ | async"
        [viewLevel]="viewLevel$ | async"
        (partsSelected)="partsSelected($event)"
        (modelChanged)="modelChanged($event)"
        (nodeDeleteRequested)="handleNodeDeleteRequested($event)"
        (linkDeleteRequested)="handleLinkDeleteRequested($event)"
        (updateNodeLocation)="handleUpdateNodeLocation($event)"
        (updateNodeExpandState)="handleUpdateNodeExpandState($event)"
      >
      </app-architecture-diagram>
    </div>
    <div *ngIf="selectedView === ArchitectureView.System">
      <smi-architecture-table-view
        [data]="nodes | layer: { byId: true, descendantIds$: parentDescendantIds } | async"
        [selectedItem]="selectedNode"
        (selectNode)="onSelectNode($event)"
        (changeLevel)="onChangeLevel($event)"
        (download)="onDownload(downloadingTemplate, 'node')"
        [view]="'system'"
        [filterValue]="tableViewFilterValue"
      ></smi-architecture-table-view>
    </div>
    <div *ngIf="selectedView === ArchitectureView.Links">
      <smi-architecture-table-view
        [data]="links | layer: { byId: false } | async"
        [selectedItem]="selectedNode"
        (selectNode)="onSelectNode($event)"
        (changeLevel)="onChangeLevel($event)"
        (download)="onDownload(downloadingTemplate, 'links')"
        [view]="'link'"
        [filterValue]="tableViewFilterValue"
      ></smi-architecture-table-view>
    </div>
  </app-model-content>
  <smi-right-sidebar
    data-hook="right-sidebar"
    *ngIf="!showOrHideRightPane"
    (rightTab)="openRightTab($event)"
    [architecturePage]="objectSelected"
    [architectureRadioTab]="radioTab"
    [architectureDetailsTab]="detailsTab"
    [filterLevel]="['system', 'data set'].indexOf(currentFilterLevel) != -1"
  >
  </smi-right-sidebar>
  <app-model-sidebar [isLast]="true" [minWidth]="450" [maxWidth]="650" *ngIf="showOrHideRightPane">
    <p class="rightPane">
      <smi-right-panel
        [owners]="selectedNode?.owners"
        [descendants]="selectedNode?.descendants"
        [selectedRightTab]="selectedRightTab"
        [group]="objectDetailsForm"
        [clickedOnLink]="clickedOnLink"
        [isEditable]="isEditable"
        (editDetails)="onEditDetails($event)"
        (saveAttribute)="onSaveObjectDetails()"
        (deleteNode)="onDeleteNode()"
        [attributes]="selectedNode?.attributes"
        [relatedRadios]="selectedNode?.relatedRadios"
        [radio]="radio$ | async"
        [properties]="selectedNode?.customPropertyValues"
        [workpackages]="selectedNode?.relatedWorkPackages"
        (cancel)="onCancelEdit()"
        [workPackageIsEditable]="workPackageIsEditable"
        (addAttribute)="onAddAttribute()"
        (deleteAttribute)="onDeleteAttribute($event)"
        (addRelatedRadio)="onAddRelatedRadio()"
        (hideRightPane)="onHideRightPane()"
        [objectSelected]="objectSelected"
        (addRadio)="onAddRadio()"
        [multipleSelected]="multipleSelected"
        (addScope)="onAddScope()"
        (addOwner)="onAddOwner()"
        (deleteOwner)="onDeleteOwner($event)"
        (saveProperties)="onSaveProperties($event)"
        (deleteProperties)="onDeleteProperties($event)"
        (addDescendant)="onAddDescendant()"
        (deleteDescendant)="onDeleteDescendant($event)"
        (openRadio)="onOpenRadio($event)"
        [nodeScopes]="nodeScopes$ | async"
        (deleteScope)="onDeleteScope($event)"
        (addExistingScope)="onAddExistingScope()"
        (addNewScope)="onAddNewScope()"
        [selectedView]="selectedView"
        [nodes]="nodes | layer: { byId: true, descendantIds$: parentDescendantIds } | async"
        [selectedNode]="selectedNode"
        (selectNode)="onSelectNode($event)"
        [links]="links | layer: { byId: false} | async"
        [viewLevel]="viewLevel$ | async"
        [part]="part"
        (assignRadio)="onAssignRadio()"
        [nodeCategory]="part?.data.category"
        [filterLevel]="['system', 'data set'].indexOf(currentFilterLevel) != -1"
        [nodeReports]="nodeReports$ | async"
        (addExistingAttribute)="onAddExistingAttribute()"
      >
      </smi-right-panel></p
  ></app-model-sidebar>
</app-model-container>

<ng-template #downloadingTemplate>
  <h3>Preparing...</h3>
</ng-template>
